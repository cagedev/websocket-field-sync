<html>

<head>
  <style type="text/css">
    * {
      box-sizing: border-box;
      font-family: sans-serif;
      font-size: small;
      margin: 2px;
    }

    body {
      margin: 20px;
      background-color: #fafafa;
    }
  </style>
</head>

<body>
  <form id="wfs-config">

    <label for="serverUrl">serverUrl</label>
    <input type="text" id="serverUrl" name="serverUrl" value="ws://127.0.0.1:8080">
    <br />

    <label for="userName">userName</label>
    <input type="text" id="userName" name="userName" value="Test User">
    <br />

    <label for="userId">userId</label>
    <input type="text" id="userId" name="userId" />
    <br />

    <label for="roomId">roomId</label>
    <input type="text" id="roomId" name="roomId" />
    <br />

    <label for="updateEvent">updateEvent</label>
    <input type="text" id="updateEvent" name="updateEvent" />
    <br />

    <label for="eventElementId">eventElementId</label>
    <input type="text" id="eventElementId" name="eventElementId" />
    <br />

    <label for="syncType">syncType</label>
    <input type="text" id="syncType" name="syncType" />
    <br />

    <button type="submit">configure</button>
  </form>

  <form id="wfs-data">
    <textarea id="targetField" name="targetField">This is the target field.</textarea>
    <br />

    <button type="submit" id="wfs-connect">connect</button>
    <button type="button" id="wfs-send">send</button>
  </form>
</body>

<script>
  var wfsConnection = null;
  var wfsConfig = {}
  var wfsData = {
    userName: '',
    userId: '',
    roomId: '',
    syncType: '',
  }

  // Event handlers
  function handleConfigure(event) {
    event.preventDefault();
    const data = new FormData(event.target);
    wfsConfig = Object.fromEntries(data.entries());

    // DEBUG
    console.log(wfsConfig);
  }

  function handleConnect(event) {
    event.preventDefault();

    wfsConnection = new WebSocket(wfsConfig.serverUrl, "json");

    wfsConnection.onopen = function (event) {
      // DEBUG
      console.log("wfsConnection.onopen");
    };

    wfsConnection.onmessage = function (event) {
      // DEBUG
      console.log("wfsConnection.onmessage");
      console.log(event.data);
    };


    // TODO
    // setup wfs-link with current parameters
    // ? auth on serverUrl
    // - connect to serverUrl
    // - send setup message
    // - set local data event handler
    //   - on event
    //   - update data package
    //   - send data
    // - set external event handler
    //   - on message
    //   - update local data package
    //   - update local data field (do not fire handler)

  };

  function handleSend(event) {
    let message = {
      type: "message",
      data: "TEST",
    }
    console.log('handleSend', message);
    wfsConnection.send(JSON.stringify(message));
  }

  // Set up event handlers
  document.getElementById('wfs-config').addEventListener('submit', handleConfigure);
  document.getElementById('wfs-data').addEventListener('submit', handleConnect);
  document.getElementById('wfs-send').addEventListener('click', handleSend);
</script>

</html>